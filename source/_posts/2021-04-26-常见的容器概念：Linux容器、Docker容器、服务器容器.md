---
title: 常见的容器概念：Linux容器、Docker容器、服务器容器
date: 2021-04-26 04:42:44
urlname: Containers.html
categories:
  - 软件工程
---

## 一、容器

### 1.1 定义

汉语释义：

> 容器(Container)是一种基础工具。泛指任何可以用于容纳其它物品的工具。

容器的特性：

- 可以部分或完全封闭。— 隔离性

- 被用于容纳、储存、运输物品。 — 便携性、换到程序的概念就是可移植性

- 物体可以被放置在容器中，而容器则可以保护内容物。— 安全

## 二、Linux容器与Docker容器

### 2.1 诞生背景—环境配置的难题

软件开发最大的麻烦事之一，就是环境配置。用户计算机的环境都不相同，你怎么知道自家的软件，能在那些机器跑起来？

用户必须保证两件事：操作系统的设置，各种库和组件的安装。只有它们都正确，软件才能运行。举例来说，安装一个 Python 应用，计算机必须有 Python 引擎，还必须有各种依赖，可能还要配置环境变量。

如果某些老旧的模块与当前环境不兼容，那就麻烦了。开发者常常会说："它在我的机器可以跑了"（It works on my machine），言下之意就是，其他机器很可能跑不了。

环境配置如此麻烦，换一台机器，就要重来一次，旷日费时。很多人想到，能不能从根本上解决问题，软件可以带环境安装？也就是说，安装的时候，把原始环境一模一样地复制过来。

### 2.2 虚拟机

虚拟机（virtual machine）就是带环境安装的一种解决方案。它可以在一种操作系统里面运行另一种操作系统，比如在 Windows 系统里面运行 Linux 系统。应用程序对此毫无感知，因为虚拟机看上去跟真实系统一模一样，而对于底层系统来说，虚拟机就是一个普通文件，不需要了就删掉，对其他部分毫无影响。

虽然用户可以通过虚拟机还原软件的原始环境。但是，这个方案有几个缺点。

**（1）资源占用多**

虚拟机会独占一部分内存和硬盘空间。它运行的时候，其他程序就不能使用这些资源了。哪怕虚拟机里面的应用程序，真正使用的内存只有 1MB，虚拟机依然需要几百 MB 的内存才能运行。

**（2）冗余步骤多**

虚拟机是完整的操作系统，一些系统级别的操作步骤，往往无法跳过，比如用户登录。

**（3）启动慢**

启动操作系统需要多久，启动虚拟机就需要多久。可能要等几分钟，应用程序才能真正运行。

### 2.3 Linux容器

由于虚拟机存在这些缺点，Linux 发展出了另一种虚拟化技术：Linux 容器（Linux Containers，缩写为 LXC）。

#### 2.3.1 定义

- Linux 容器技术能够让您对应用及其整个运行时环境（包括全部所需文件）一起进行打包或隔离。从而让您可以在不同环境（如开发、测试和生产等环境）之间轻松迁移应用，同时还可保留应用的全部功能。 —  [Red Hat官网](https://www.redhat.com/zh/topics/containers)
- 容器是包含在任何环境中运行所需的所有元素的软件包。是轻量级应用代码包，还包含了依赖项，例如编程语言运行时的特定版本和运行软件服务所需的库。 —  [ Google Cloud官网](https://cloud.google.com/learn/what-are-containers?hl=zh-cn#section-1)

- Linux 容器，又称Linux软件容器，是一种操作系统层虚拟化技术，为Linux内核容器功能的一个用户空间接口。它将应用软件系统打包成一个软件容器(Container)，内含应用软件本身的代码，以及所需要的操作系统核心和库。

  Linux 容器透过统一的名字空间和共享API来分配不同软件容器的可用硬件资源，创造出应用程序的独立沙箱运行环境，使得Linux用户可以容易的创建和管理系统或应用容器。— [维基百科](https://zh.wikipedia.org/wiki/LXC)

总之：容器就是代码/应用程序+运行时环境

LXC通常被认为介于“加强版”的chroot和完全成熟的虚拟机之间的技术。LXC的目标是创建一个尽可能与标准安装的Linux相同但又不需要分离内核的环境。

容器虚拟化操作系统，可以在任何地方运行，不管目标环境是私有数据中心、公有云，还是开发者的个人笔记本电脑。

容器也是保障 IT 安全的一个重要组成部分。将安全性内置于容器管道，可以为基础架构增添防护，从而保障容器的可靠性、可扩展性和信赖度。

#### 2.3.2 优势

**Linux 容器不是模拟一个完整的操作系统，而是对进程进行隔离。**或者说，在正常进程的外面套了一个[保护层](https://opensource.com/article/18/1/history-low-level-container-runtimes)。对于容器里面的进程来说，它接触到的各种资源都是虚拟的，从而实现与底层系统的隔离。

由于容器是进程级别的，相比虚拟机有很多优势。

**（1）启动快**

容器里面的应用，直接就是底层系统的一个进程，而不是虚拟机内部的进程。所以，启动容器相当于启动本机的一个进程，而不是启动一个操作系统，速度就快很多。

**（2）资源占用少**

容器只占用需要的资源，不占用那些没有用到的资源；虚拟机由于是完整的操作系统，不可避免要占用所有资源。另外，多个容器可以共享资源，虚拟机都是独享资源。

**（3）体积小**

容器只要包含用到的组件即可，而虚拟机是整个操作系统的打包，所以容器文件比虚拟机文件要小很多。

总之，容器有点像轻量级的虚拟机，能够提供虚拟化的环境，但是成本开销小得多。

#### 2.3.3 使用

LXC的使用：

- Proxmox VE: 它直到4.0版才使用LXC技术，在此之前的版本都是使用OpenVZ技术。

- Docker：它在0.9版之前都是使用LXC技术，但在0.9版之后，已不再是唯一且默认的运行环境。

  **Docker 属于 Linux 容器的一种封装，提供简单易用的容器使用接口。**是目前最流行的 Linux 容器解决方案。

  Docker 将应用程序与该程序的依赖，打包在一个文件里面。运行这个文件，就会生成一个虚拟容器。程序在这个虚拟容器里运行，就好像在真实的物理机上运行一样。有了 Docker，就不用担心环境问题。

  总体来说，Docker 的接口相当简单，用户可以方便地创建和使用容器，把自己的应用放入容器。容器还可以进行版本管理、复制、分享、修改，就像管理普通的代码一样。

### 2.4 Docker容器

[Docker — 从入门到实践](https://yeasy.gitbook.io/docker_practice/)

#### 2.4.1 概述

Docker 使用 Google 公司推出的 Go 语言 进行开发实现，基于 Linux 内核的 cgroup，namespace，以及 OverlayFS 类的 Union FS 等技术，对进程进行封装隔离，属于 操作系统层面的虚拟化技术。由于隔离的进程独立于宿主和其它的隔离的进程，因此也称其为容器。

- 最初实现是基于 LXC
- 从 0.7 版本以后开始去除 LXC，转而使用自行开发的 libcontainer
- 从 1.11 版本开始，则进一步演进为使用 runC 和 containerd。

**Docker** 自开源后受到广泛的关注和讨论，至今其 [GitHub 项目](https://github.com/moby/moby) 已经超过 6 万 多个星标和一万多个 `fork`。甚至由于 `Docker` 项目的火爆，在 `2013` 年底，dotCloud 公司决定改名为 Docker。`Docker` 最初是在 `Ubuntu 12.04` 上开发实现的；`Red Hat` 则从 `RHEL 6.5` 开始对 `Docker` 进行支持；`Google` 也在其 `PaaS` 产品中广泛应用 `Docker`。

#### 2.4.2 用途

Docker 的主要用途，目前有三大类。

**（1）提供一次性的环境。**比如，本地测试他人的软件、持续集成的时候提供单元测试和构建的环境。

**（2）提供弹性的云服务。**因为 Docker 容器可以随开随关，很适合动态扩容和缩容。

**（3）组建微服务架构。**通过多个容器，一台机器可以跑多个服务，因此在本机就可以模拟出微服务架构。

#### 2.4.3 镜像Image

镜像Image于Docker容器（本质上还是程序与进程的区别？）

##### 1) 引自Docker网站

镜像/映像（`Image`）和容器（`Container`）的关系，就像是面向对象程序设计中的 `类` 和 `实例` 一样，镜像是静态的定义，容器是镜像运行时的实体。容器可以被创建、启动、停止、删除、暂停等。

**容器映像**：包含创建容器所需的所有依赖项和信息的包。 映像包括所有依赖项（例如框架），以及容器运行时使用的部署和执行配置。 通常情况下，映像派生自多个基础映像，这些基础映像是堆叠在一起形成容器文件系统的层。 创建后，映像不可变。

容器的实质是进程，但与直接在宿主执行的进程不同，容器进程运行于属于自己的独立的命名空间。因此容器可以拥有自己的 `root` 文件系统、自己的网络配置、自己的进程空间，甚至自己的用户 ID 空间。容器内的进程是运行在一个隔离的环境里，使用起来，就好像是在一个独立于宿主的系统下操作一样。这种特性使得容器封装的应用比直接在宿主运行更加安全。也因为这种隔离的特性，很多人初学 Docker 时常常会混淆容器和虚拟机。

##### 2) 引自阮一峰

**Docker 把应用程序及其依赖，打包在 image 文件里面。**只有通过这个文件，才能生成 Docker 容器。image 文件可以看作是容器的模板。Docker 根据 image 文件生成容器的实例。同一个 image 文件，可以生成多个同时运行的容器实例。

image 是二进制文件。实际开发中，一个 image 文件往往通过继承另一个 image 文件，加上一些个性化设置而生成。举例来说，你可以在 Ubuntu 的 image 基础上，往里面加入 Apache 服务器，形成你的 image。

```bash
# 列出本机的所有 image 文件。
$ docker image ls

# 删除 image 文件
$ docker image rm [imageName]
```

image 文件是通用的，一台机器的 image 文件拷贝到另一台机器，照样可以使用。一般来说，为了节省时间，我们应该尽量使用别人制作好的 image 文件，而不是自己制作。即使要定制，也应该基于别人的 image 文件进行加工，而不是从零开始制作。

为了方便共享，image 文件制作完成后，可以上传到网上的仓库。Docker 的官方仓库 [Docker Hub](https://hub.docker.com/) 是最重要、最常用的 image 仓库。此外，出售自己制作的 image 文件也是可以的。

### 2.5 容器与虚拟机的区别

虚拟机：一种运行在主机操作系统之上，可以访问底层硬件的客机操作系统，例如Linux 或 Windows。

容器常常被拿来和虚拟机 (VM) 比较。与虚拟机相似，容器也可以让您将应用与库和其他依赖项打包，提供独立环境来运行您的软件服务。

但是两者的相似性仅此而已，因为容器为开发者和 IT 运营团队提供了更加轻型、具有众多优势的运营单元。

- 容器比虚拟机更加轻量化
- 容器在操作系统级别进行虚拟化，而虚拟机在硬件级别进行虚拟化
- 容器共享操作系统内核，其占用的内存与虚拟机相比微乎其微

### 2.6 容器化的优势

容器化是软件开发的一种方法，通过该方法可将应用程序或服务、其依赖项及其配置（抽象化为部署清单文件）一起打包为容器映像。容器化应用程序可以作为一个单元进行测试，并可以作为容器映像实例部署到主机操作系统 (OS)。 [参考链接](https://docs.microsoft.com/zh-cn/dotnet/architecture/microservices/container-docker-introduction/)

容器在整个应用程序生命周期工作流中提供以下优点：

- **责任分离**：容器化使开发者和 IT 运营团队的责任泾渭分明，开发者专注于应用逻辑和依赖项，而 IT 运营团队可以专注于部署和管理，不必为应用细节分心，例如具体的软件版本和配置。

- **工作负载可移植性**：

  - 软件容器充当软件部署的标准单元，其中可以包含不同的代码和依赖项。 按照这种方式容器化软件，开发人员和 IT 专业人员只需进行极少修改或不修改，即可将其部署到不同的环境。
  - 容器几乎能在任何地方运行，极大减轻了开发和部署工作量：在 Linux、Windows 和 Mac 操作系统中；在虚拟机或物理服务器上；在开发者的机器或本地数据中心的机器上；当然还有在公有云上。
  - 就像船只、火车或卡车运输集装箱而不管其内部是什么货物一样。

- **应用隔离/隔离性**：容器会在操作系统级别虚拟化 CPU、内存、存储和网络资源，为开发者提供在逻辑上与其他应用相隔离的操作系统接口，即在共享 OS 上将应用程序彼此隔离开。

- **灵活性**：轻量级。容器化应用程序在容器主机上运行，而容器主机在 OS（Linux 或 Windows）上运行。 因此，容器的占用比虚拟机 (VM) 映像小得多。

  每个容器可以运行整个 Web 应用或服务，如下图所示，在一个容器主机上运行多个容器。 在此示例中，Docker 主机是容器主机，而 App1、App2、Svc 1 和 Svc 2 是容器化应用程序或服务。

<img src = '/images/Docker/multiple-containers-single-host.png' width = '50%'>

- **可伸缩性**：通过为短期任务创建新容器，可以快速扩大。 从应用程序的角度来看，实例化映像（创建容器）类似于实例化 服务或 Web 应用等进程。 

  但出于可靠性考虑，在多个主机服务器上运行同一映像的多个实例时，通常要使每个容器（映像实例）在不同容错域中的不同主机服务器或 VM 中运行。

## 三、服务器与容器

### 3.1 服务器(server)

服务器(server)指：[服务器](https://zh.wikipedia.org/wiki/%E6%9C%8D%E5%8A%A1%E5%99%A8)

- 一个管理资源并为用户提供服务的计算机软件，通常分为文件服务器（能使用户在其它计算机访问文件），数据库服务器和应用程序服务器。

- 运行以上软件的计算机，或称为网络主机（host）。通常是指那些具有较高计算能力，能够提供给多个用户使用的计算机。

有时，这两种定义会引起混淆。如网页服务器：

- 它可能是指用于网站的计算机。
- 也可能是指像Apache这样的软件，运行在这样的计算机上以管理网页组件和回应网页浏览器的请求。

根据服务器提供的服务类型不同，分为文件服务器，数据库服务器，应用程序服务器，Web服务器等。

#### 3.1.1 作为硬件

服务器与PC机的不同点很多：
- 服务器的最大特点就是其强大的运算能力或是具备大量磁盘存储空间，使其能在短时间内完成大量工作及负载大量的文件资料存储，并为大量用户提供服务。
- 服务器通常以网络作为介质，既可以通过内部网对内提供服务，也可以通过互联网对外提供服务。所以PC机在一个时刻通常只为一个用户服务。而服务器能够通过网络同时提供给多个用户使用
- 和普通的个人电脑相比， 服务器需要连续的工作在7×24小时环境。这就意味着服务器需要更多的稳定性技术RAS，比如支持使用ECC存储器。

#### 3.1.2 作为软件

服务器软件工作在客户端-服务器或浏览器-服务器的方式，有很多形式的服务器，常用的包括：

- 文件服务器(file server)或网络存储设备(network attached storage)

- 数据库服务器(database server) —— 如Oracle数据库服务器，MySQL，MariaDB，PostgreSQL，Microsoft SQL Server，MongoDB，Redis等；

- 应用程序服务器(application server/AP server)

  - **运行应用程序，提供应用程序所实现服务**。通常来说，**服务器端的应用程序实现各种业务逻辑，应用服务器通过各种协议把这些业务逻辑曝露给客户端的程序**。它提供了访问业务逻辑的途径，以供客户端应用程序使用。应用服务器使用此业务逻辑就像调用对象的一个方法一样。
  - 如Bea公司的WebLogic、JBoss、Sun的GlassFish，及Tomcat、Jetty、Websphere、JBoss等都是Java EE WEB应用服务器/**Java EE服务器**
    - Java EE服务器是实现Java EE技术规范，并提供标准Java EE服务的应用程序服务器。
    - Java EE服务器有时称为应用服务器，因为它们允许您向客户端提供应用数据，就像Web服务器向Web浏览器提供Web页面一样。

- 网页服务器(Web server) 

  - WEB：现广泛译作网络、互联网等技术领域。表现为三种形式，即**超文本（hypertext）、超媒体（hypermedia）、超文本传输协议（HTTP）**等。
  - Web server可以向浏览器等WEB客户端提供文档浏览、数据文件下载等WEB服务。
  - 如Apache、lighttpd、nginx、微软的IIS等；

- FTP服务器（FTP server）—— Pureftpd、Proftpd、WU-ftpd、Serv-U、vs-ftpd等；

- 邮件服务器(mail server)

- 域名服务器（DNS server）—— 如BIND等

- 代理服务器（proxy server）—— 如Squid cache

- 其他，如Active Directory服务器、Minecraft游戏服务器等

- 补充：WEB应用服务器

  - 上面我们把应用服务器和WEB服务器严格区分：应用服务器通过应用程序接口(通常是网络请求API）把业务逻辑暴露给客户端应用程序。而WEB服务器通过HTTP提供静态内容给浏览器等客户端。

    如果不严格区分，应用服务器包含WEB服务器，因为WEB服务器是WEB服务应用程序实现的。

  - WEB应用服务器：结合应用服务器和WEB服务器，可以说，它是带应用服务器的Web服务器，接收HTTP请求后，既能返回页面等静态内容，又能处理业务逻辑返回数据。

<img src = '/images/Docker/servers.jpg' width = '70%' align:left style='margin-left:10%'>

### 3.2 容器

如果说Linux、Docker容器是装满物体的容器：应用/服务程序 + 运行时环境

那么服务器中说的容器就是纯指未装物体的容器：运行时环境 — **可以部署应用程序，使其在上面运行的环境**。

<img src = '/images/Docker/container_server.jpg' width = '50%' align:left style='margin-left:10%'>

容器是服务器中位于应用程序/组件和平台之间的`接口集合`。它处理屏蔽了服务器平台的复杂性(如线程安全、事务、网络、资源等细节)，使得应用程序在它的基础上可以方便快捷的部署。[Web容器](https://zh.wikipedia.org/zh-hans/Web%E5%AE%B9%E5%99%A8)

- 容器管理组件的生命周期，向应用程序组件分派请求，并提供与上下文数据（如关于当前请求的信息）的接口。

- 容器一般位于服务器之内，由服务器负责加载和维护。一个容器只能存在于一个服务器之内，一个服务器可以创建和维护多个容器。

- 容器一般遵守可配置的原则，即容器的用户可以通过对容器参数的配置，来达到自己的使用需求，而不需要修改容器的代码。

根据接口实现的规范、用途不同，常见的分类有：

<img src = '/images/Docker/containers.jpg' width = '70%' align:left style='margin-left:10%'>

#### 3.2.1 Servlet容器

Servlet：属于Java EE重要技术规范，构建了"接收请求--调用servlet程序处理--返回响应"基本模型。

Servlet程序：Java提供了开发Servlet程序的API，该API可以说Servlet容器的一部分，它对接应用程序与Servlet容器；

Servlet容器：就是**实现了Servlet**技术规范的部署环境，它可以部署运行Servlet程序。

#### 3.2.2 Java WEB容器

WEB容器：可以部署多个WEB应用程序的环境。

Java WEB容器：**实现了Java EE**规定的WEB应用技术规范的的部署环境。

Java EE WEB应用技术规范：Servlet、JSP（JavaServer Pages）、Java WebSocket等。

所以，完整的**Java WEB**容器包含Servlet容器。

#### 3.2.3 Java EE容器

Java EE容器：实现了Java EE技术规范的部署环境。

Java EE技术规范：除了上面说的Servlet、JSP等Java EE WEB应用技术规范，还包括EJB（Enterprise JavaBeans）等许多技术规范。

所以，**完整的Java EE**容器包含Java WEB容器（Servlet容器）、EJB容器等。



### 3.3 举例说明容器与服务器的联系

> 服务器是指管理资源并为用户提供服务的计算机软件，或运行该软件的硬件设备。

> 容器是对服务器平台上接口的一层上层封装，屏蔽一些复杂性，提供简化版的接口。使得程序可以在其上快捷的开发和部署运行。

#### 3.3.1 Apache、Nginx、IIS

Apache、Nginx、IIS是目前主流的三个Web服务器。

但是可以用它们来构建WEB应用服务器，通常它们发现一个请求是动态请求，就通过CGI、ISAPI、特殊管道等协议接口调用后面的应用服务器来协同处理请求。如Nginx通过fastCGI模块来调用ZendEngine执行PHP应用来处理PHP请求。

#### 3.3.2 Tomcat及常见的JavaEE应用服务器

Tomcat、Jetty、WebLogic、Websphere、JBoss都是Java（EE） WEB应用服务器。

Tomcat

- 按照Sun Microsystems提供的技术规范，实现了对Servlet和JavaServer Page（JSP）、Java Expression Language 和 Java WebSocket（Java EE）技术的支持。并提供了作为Web服务器的一些特有功能，如Tomcat管理和控制平台、安全局管理和Tomcat阀等。
- 因为实现了Servlet规范，所以可以称为是一个Servlet容器，可以运行Servlet程序
- 由于Tomcat本身也内含了HTTP服务器，可以通过HTTP提供HTML页面等静态内容的请求访问，因此也可以视作是一个Web服务器。
- 因为可以通过Servlet容器，调用Servlet处理动态请求，所以也是一个应用服务器；

所以，可以说Tomcat是Java（EE） WEB应用服务器。

注意，不能将Tomcat和Apache HTTP服务器混淆，Apache HTTP服务器是用C语言实现的HTTPWeb服务器；这两个HTTP web server不是捆绑在一起的。Apache Tomcat包含了配置管理工具，也可以通过编辑XML格式的配置文件来进行配置。

Tomcat提供了一个Jasper编译器用以将JSP编译成对应的Servlet。

Tomcat的Servlet引擎通常与Apache或者其他Web服务器一起工作。除了用于开发过程中的调试以及那些对速度和事务处理只有很小要求的用户，很少会将Tomcat单独作为Web服务器。但随着版本的更新，正有越来越多的用户将其单独作为Web服务器用以那些对速度和可靠性有较高要求的环境中。

#### 3.3.3 Nginx + Tomcat的WEB应用服务器(集群)

<img src = '/images/Docker/nginx_tomcat.jpg' width = '50%' align:left style='margin-left:10%'>

一般在实际应用中：

- 先是通过Nginx反向代理服务器(reverse proxy server)接收请求，匹配分离动态/静态请求（动静分离）
- 如果是静态请求，则转发到另外的Nginx WEB服务器上，返回静态内容；
- 如果是动态请求，则转发到后面的Tomcat应用服务器，处理动态请求的业务逻辑。

[参考链接 — 各种容器与服务器的区别与联系](https://blog.csdn.net/tjiyu/article/details/53148174)

## 五、iOS的容器化



## 六、小结

容器在不同场景下的含义

1. 字面意思，容器就是指容纳小物品的事物，比如：
   1. UIStackview
   2. 自定义的Container视图组件
   3. 前端组件化开发中的页面充当的角色(将一个页面分成很多个组件，此处页面就相当于是个纯粹的容器)
2. 代码/数据的运行环境，完成代码的解释/数据解析。比如：
   1. 美团，后端返回协商好的结构化的数据，移动端对数据进行解析，还原成界面的layout。进行视图创建、渲染

   2. 上面的Docker容器
   3. 服务器容器